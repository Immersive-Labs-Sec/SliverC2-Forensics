# Copyright 2023 Immersive Labs
# Detects Default Sliver C2 configuratio
# Please note due to the design of the C2 these patterns may match legitimate traffic

alert tcp any any -> any $HTTP_PORTS (msg:"Sliver C2 Session Start Detected"; flow:to_server,established; content:"POST"; http_method; pcre:"/\/(?:php|api|upload|actions|rest|v1|auth|authenticate|oauth|oauth2|oauth2callback|database|db|namespaces\/)?(login|signin|api|samples|rpc|index|admin|register|sign-up)\.html\?[a-zA-Z]=/U"; pcre: "/(PHPSESSID|SID|SSID|APISID|csrf-state|AWSALBCORS)/C"; classtype:trojan-activity; sid:1000001; rev:1;)
alert tcp any any -> any $HTTP_PORTS (msg:"Sliver C2 Session Message Detected"; flow:to_server,established; content:"POST"; http_method; pcre:"/\/(?:php|api|upload|actions|rest|v1|auth|authenticate|oauth|oauth2|oauth2callback|database|db|namespaces\/)?(login|signin|api|samples|rpc|index|admin|register|sign-up)\.php\?[a-zA-Z]=/U"; pcre: "/(PHPSESSID|SID|SSID|APISID|csrf-state|AWSALBCORS)/C"; classtype:trojan-activity; sid:1000002; rev:1;)
alert tcp any any -> any $HTTP_PORTS (msg:"Sliver C2 Poll Detected"; flow:to_server,established; content:"GET"; http_method; pcre:"/\/(?:js|umd|assets|bundle|bundles|scripts|script|javascripts|javascript|jscript\/)?(bootstrap|bootstrap.min|jquery.min|jquery|route|app|app.min|array|backbone|script|email)\.js\?[a-zA-Z]=/U"; pcre: "/(PHPSESSID|SID|SSID|APISID|csrf-state|AWSALBCORS)/C"; classtype:trojan-activity; sid:1000003; rev:1;)
alert tcp any any -> any $HTTP_PORTS (msg:"Sliver C2 Close File Detected"; flow:to_server,established; content:"GET"; http_method; pcre:"/\/(?:static|www|assets|images|icons|image|icon|png\/)?(favicon|sample|example)\.png\?[a-zA-Z]=/U"; pcre: "/(PHPSESSID|SID|SSID|APISID|csrf-state|AWSALBCORS)/C"; classtype:trojan-activity; sid:1000004; rev:1;)
